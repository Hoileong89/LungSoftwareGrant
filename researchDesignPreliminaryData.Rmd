
## __3(c) Research design__

### 3(c.1) Preliminary data

__3(c.1.1) Generic ANTs core tools for image analysis and processing.__
The Advanced Normalization Tools (ANTs) package is a state-of-the-art, open-source software toolkit
for image registration, segmentation, and other core medical image analysis functionality.
Several core programs comprising portions of the proposed pulmonary software framework
have been created and made available within ANTs (and either simultaneously or subsequently
made available in ITK).  However, as mentioned earlier, these programs have more
general application and require pulmonary-specific tuning for the tasks targeted by
this proposal.  The following list comprises several core software tools for
tuning, subsequent extensions, documentation, tutorial generation, and the creation of
easy-to-use bash scripts for large-scale processing of pulmonary imaging data.

__ANTs image registration.__  One of the most important methodological developments in
medical image analysis is the advent of image registration techniques capable of
accommodating the highly complex inter-individual variations seen in human anatomy.
Our team is well-recognized for seminal contributions to the field that date back to the
original elastic matching method of Bajcsy and co-investigators
[@Bajcsy:1982aa;@Bajcsy:1989aa;@Gee:1993aa]. Our most recent work, embodied in the ANTs
open-source, cross-platform toolkit for multiple modality image processing,
continues to set the standard in the field. ANTs not only encodes the most advanced results
in registration research, notably the Symmetric Normalization (SyN) algorithm for
diffeomorphisms [@Avants:2008aa], but also packages these within a full featured platform that
includes an extensive library of similarity measures, transformation types, and regularizers.
Recently, a thorough comparison with the original SyN algorithm was performed using a B-spline variant [@Tustison:2013ac].
This evaluation utilized multiple publicly available, annotated brain data sets and
demonstrated statistically significant improvement in label overlap measures.  As part of
that study, we produced the scripts ``antsRegistrationSyN.sh`` and
``antsRegistrationSyNQuick.sh`` which provide a simple interface to our normalization tools
for brain-specific normalization and are two of the most widely used scripts in the ANTs
toolkit.  _Similar to the developments that we are proposing,
these scripts were extensively modified to serve as a follow-up entry into the EMPIRE10 lung
registration challenge where B-spline SyN performed better than its original counterpart on pulmonary
data [@Tustison:2012aa]._

__Multi-modal template generation.__  Given the variability in anatomical shape across
populations and the lack of publicly available atlases for specific organs, generating population- or
subject-specific optimal shape/intensity templates significantly enhances study potential
[@Avants:2010aa;@Tustison:2014aa].  First, an average template is estimated via a voxel-wise
mean of all the individual subject images.  This estimate is iteratively updated by registering
each image to the current
template, performing a voxelwise average to create a new estimate, and then "reshaping"
this template based on the average inverse transformation which "moves" the template estimate
closer to the group mean.  See Figure 2 for a cohort-specific multi-modal brain template
for females in the age range 50--60.
This functionality has proven to be a vital component of the ANTs toolkit for performing neuroimaging research
(e.g., [@Avants:2015aa;@Datta:2012aa;@McMillan:2014aa;@Cook:2014aa;@Tustison:2014ad;@Tustison:2014ab]).
_Similarly, this functionality has also demonstrated significant importance in
pulmonary studies [@Tustison:2013ad]._


__Bayesian segmentation with spatial and MRF priors.__
Early statistically-based segmentation work appropriated NASA satellite image processing
software for classification of head tissues in 2-D MR images [@Vannier:1985aa]. Following
this work, many researchers adopted statistical methods for $n$-tissue anatomical brain
segmentation. The Expectation-Maximization (EM) framework is natural [@Dempster:1977aa]
given the "missing data" aspect of this problem. Core components of this type of work include
the explicit modeling of the tissue intensity values as statistical distributions
[@Cline:1990aa;@Kikinis:1992aa] and the use of Markov Random Field (MRF) modeling [@Geman:1984aa] for regularizing
the classification results [@Held:1997aa].  Spatial
prior probability maps of anatomical structures of interest are also employed within this framework
[@Van-Leemput:1999aa;@Ashburner:2005aa].  Although this particular segmentation
framework has significant application in the neuroimaging domain, it is also relevant
to other domains including functional
ventilation of the lung [@Tustison:2011aa].  _However, despite the numerous
developments which have been proposed
over the years within this area, there are an extremely limited number of actual software implementations.
This deficit inspired us to create our own Bayesian
segmentation framework [@Avants:2011aa] (denoted as Atropos) which we have made publicly
available within ANTs and has proven highly effective in quantification of
functional lung imaging [@Tustison:2011aa;@Altes:2012aa;@Teague:2014aa;@Kirby:2014aa]._

__N4 bias correction.__  Critical to quantitative processing of MRI is the minimization of field
inhomogeneity effects which produce artificial low frequency intensity variation across the image.
Large-scale studies, such as ADNI, employ perhaps the most widely used bias correction algorithm,
N3 [@Sled:1998aa], as part of their standard protocol [@Boyes:2008aa].
In [@Tustison:2010aa] we introduced an improvement of N3, denoted as "N4", which demonstrates
a significant increase in performance and convergence behavior on a variety of data. This
improvement is a result of an enhanced fitting routine (which includes multi-resolution
capabilities) and a modified optimization formulation.

__Joint label fusion for prior-based segmentation.__  Joint label fusion (JLF) is the current
state-of-the-art for propagating expert labelings from a reference atlas library onto new
instances of unlabeled data. Image registration is used to align the atlas library
(images + segmentations) to a common space. A statistical model is then used to combine
the "guesses" from all the normalized atlas labels to provide a "best guess" estimate of
the target labeling. Several such algorithms have been developed and much effort has been
devoted to determining relative performance levels---see, for example, the recent MICCAI 2012
Grand Challenge and Workshop on Multi-Atlas Labeling).  The joint fusion (JLF) algorithm of
[@Wang:2013aa;@Wang:2013ab] from our group is one of the top performing JLF algorithms. JLF is capable
of predicting anatomical labels with accuracy that rivals expert anatomists [@Yushkevich:2010aa].
It has proven its effectiveness not only in cardiac data [@MALF],
the human brain [@Tustison:2014ab], and in multiple modality canine MRI [@MALF] _but has
also been successfully extended to the challening problem of applying prior-based information to lung and lobe
segmentation [@Tustison:2015aa]._

__Spatially adaptive denoising.__ Patch-based
denoising is critical for data "cleaning" prior to subsequent processing such
as segmentation or spatial normalization.  ANTs implements a state-of-the-art
spatially adaptive version to denoising recently proposed in [@Manjon:2010aa].

The previously described core tools, as well as several others, have been part of ANTs and
ITK development efforts for more than a decade.  The deficiency of publicly
available tools within the neuroscience community was the original motivation for the inception and
continued development of ANTs.  As a result, our team is well-recognized for our many
open-source advancements including important contributions to the
field of image registration outlined earlier.  Indeed, ANTs-based image registration serves
as the basis for the registration component of the latest version of the National Library of
Medicine Insight Toolkit (ITK) programming library (http://www.itk.org) which is the leading
open-source platform for medical image analysis. _The
combination of state-of-the-art algorithms and feature-rich flexibility has translated
to top-placed rankings in major independent evaluations for core elements of the ANTs
toolkit:_

* SyN was a top performer in a fairly recent large-scale brain normalization evaluation [@Klein:2009aa].
* SyN also competed in the Evaluation of Methods for Pulmonary Image
REgistration 2010 (EMPIRE10) challenge [@Murphy:2011aa] where it was the top performer
for the benchmarks
used to assess lung registration accuracy and biological plausibility of the inferred
transform (i.e., boundary alignment, fissure alignment, landmark correspondence, and
displacement field topology).  The competition has continued to the present and
SyN has remained the top-ranked algorithm.
* The joint label fusion algorithm of [@Wang:2012aa;@Wang:2013aa] (coupled with SyN)
  was top-ranked in the MICCAI 2012 challenge for labeled brain data [@Landman2012]
  and in 2013 for labeled canine hind leg data [@Asman2013].
* The multivariate template capabilities in ANTs were combined with random forests to win
the Brain Tumor segmentation (BRATS) competition at MICCAI 2013 [@Tustison:2014aa].
* A B-spline variant of the SyN algorithm [@Tustison:2013ac] won the best paper award at the
STACOM 2014 workshop for cardiac motion estimation [@Tustison:2015ab].


__3(c.1.2) Neuroimaging with ANTs as a model for the pulmonary community.__
ANTs takes advantage of
the mature Insight ToolKit in providing an optimal software framework for building scripts
and programs specifically for neuroimaging.  For example, the following core neuroimage
processing algorithms have been made available through our ANTs toolkit (complete with
online self-contained examples with developer-tuned parameters) and have been used extensively
by the community:

* brain normalization [@Avants:2011ab;@Avants:2014aa] (https://github.com/stnava/BasicBrainMapping),
* brain template generation [@Avants:2010aa] (https://github.com/ntustison/TemplateBuildingExample),
* skull-stripping or brain extraction [@Avants:2010ab;@Tustison:2014ab] (https://github.com/ntustison/antsBrainExtractionExample),
* prior-based brain tissue segmentation [@Avants:2011ab] (https://github.com/ntustison/antsAtroposN4Example),
* cortical  thickness estimation [@Das:2009aa;@Tustison:2014ab] (https://github.com/ntustison/antsCorticalThicknessExample),
* brain tumor segmentation [@Tustison:2014aa] (https://github.com/ntustison/ANTsAndArboles), and
* cortical labeling [@Wang:2012aa;@Wang:2013aa] (https://github.com/ntustison/MalfLabelingExample).

![Core processing tools that have made the ANTs package one of the most popular neuroimaging
toolkits.  Fundamental processing tasks such as image registration, template generation,
bias correction, denoising, intensity-based segmentation, and joint label
fusion are extremely well-performing software components which have been utilized for
neuroimaging tasks such as brain extraction and cortical thickness estimation.
The target applications of these core tools have an immediate analog for lung-specific
tasks such as lung and lobe segmentation.](Figs/coreANtsToolsNeuro.png)

All of these tools have been wrapped in easy-to-use, well-documented shell scripts.  For
example, the ANTs cortical thickness pipeline, as outlined in [@Tustison:2014ab], comprises
four major steps:  (1) bias correction, (2) brain extraction, (3) $n$-tissue segmentation,
and (4) cortical thickness estimation.  Each step requires its own set of ANTs tools with
appropriately tuned parameters. To maximize the utility of the pipeline for the interested
user, in [@Tustison:2014ab] we provide all the necessary programs (properly tuned) with
a minimal set of input data required to obtain good results for common data.  The result
is an easy-to-use script that can be invoked by the programmer and non-programmer alike to
obtain the desired processed data which outperforms the current state-of-the-art
[@Tustison:2014ab].  An example command call for the ANTs cortical thickness pipeline is:
```bash
  # ANTs processing call for a single subject

  $ sh antsCorticalThickness.sh -d 3 \
                                -a IXI/T1/IXI002-Guys-0828-T1.nii.gz \
                                -e IXI/template/T_Template0.nii.gz \
                                -m IXI/template/T_template0ProbabilityMask.nii.gz \
                                -f IXI/template/T_template0ExtractionMask.nii.gz \
                                -p IXI/template/Priors/priors%d.nii.gz \
                                -o IXI/ANTsResults/IXI002-Guys-02828-
```
This approach to reducing the steep learning curve associated with many processing pipelines
has several benefits.  Bash is an extremely common command language that permits large-scale
processing.  Thus, running several jobs on a cluster infrastructure is straightforward with
this approach.  Such scripts are readable
by the interested user who can glean parameters as well as manually make changes.


__3(c.1.3) ITK-SNAP.__
Project investigator Paul Yushkevich leads the development of ITK-SNAP [@Yushkevich:2006aa], a multi-platform
open-source tool for interactive user-guided medical image segmentation and data visualization. ITK-SNAP provides
an effective combination of semi-automatic segmentation functionality based on active
contours [@Caselles:1997aa;@Zhu:1996aa] and manual delineation functionality, put together into a compact and
easy-to-learn graphical user interface. ITK-SNAP supports segmentation of multiple
volumetric imaging modalities, species, and anatomical regions, without bias to any
particular problem domain. Compared to other, larger open-source image analysis tools,
ITK-SNAP design focuses specifically on the problem of image segmentation, and extraneous
or unrelated features are kept to a minimum. The design also emphasizes interaction and
ease of use, with the bulk of the development effort dedicated to the user interface.
ITK-SNAP has thousands of users (there have been over 2000 downloads per month in the
last year), and our 2006 paper on ITK-SNAP [@Yushkevich:2006aa] has been cited over 1400 times (Google
Scholar) in the context of various biomedical domains. In recent years, ITK-SNAP
development and maintenance were funded by grant 5R01 EB014346, and under this grant,
powerful new functionality for registration was developed. ITK-SNAP will be used in this project for manual labeling
of the proposed CT lung atlases; it is already used for this purpose by many investigators.
_Most crucially, we believe that our track record with ITK-SNAP as
well as ANTs demonstrates our team’s commitment to producing high-quality research
software and making it accessible to the wider research community through open-source
practices, intuitive user interfaces, and outreach efforts. These strengths of the team
will be applied to the software and data developed in the course of this project._


<!--

<img src="Figs/snap.png" alt="Screenshot of the well-known ITK-SNAP open source tool showing co-registered 1H (left) and 3He MRI (right).  The spatially normalized images permits extraction of anatomical information (i.e., lung and lobar regions) and functional information in terms of ventilation.  Shown in the bottom left panel is the surface rendering of the ventilation-based segmentation." style="width: 200px;"/>

![Screenshot of the well-known ITK-SNAP open source tool showing co-registered 1H (left) and
3He MRI (right).  The spatially normalized images permits extraction of anatomical information
(i.e., lung and lobar regions) and functional information in terms of ventilation.  Shown
in the bottom left panel is the surface rendering of the ventilation-based segmentation.](Figs/snap.png)

-->
