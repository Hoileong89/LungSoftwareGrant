---
output:
  pdf_document:
    fig_caption: true
    latex_engine: xelatex
    keep_tex: yes
header-includes:
   - \usepackage{booktabs}
bibliography: references.bib
csl: national-science-foundation-grant-proposals.csl
fontsize: 11pt
mainfont: Georgia
geometry: margin=0.5in
---

<!-- https://grants.nih.gov/grants/ElectronicReceipt/pdf_guidelines.htm -->


```{r setup, include=FALSE}
knitr::opts_chunk$set( cache=TRUE )
```

# Specific Aims

Medical research significantly benefits from the development and proliferation of imaging-related
analysis packages, particularly those softwares which have been tailored for
specific application domains.  Although several such established packages exist for
*neuroimaging* research (e.g., FSL, FreeSurfer, AFNI, SPM), no such package exists for
pulmonary imaging analysis.  The primary goal of this proposal is to develop
a robust, open-source image analysis toolkit and dissemination platform, along with annotated
data, specifically targeted at the pulmonary research community.

Although methodological research is continually being presented at conferences and
published in various venues, the unfortunate reality is that much of this work exists
strictly in “advertisement” form.  Oftentimes the underlying code is unavailable to other
researchers or is implemented in a limited manner (i.e., strictly as proof-of-concept
software).  Frequently, crucial parameter choices are omitted in the corresponding
publication(s) which makes external implementations difficult.  In addition, the data used
to showcase the proposed methodologies are often private and actual data visualization is
limited to carefully selected snapshots for publication (i.e., advertisement) purposes
which might not be representative of algorithmic performance.  Finally, many of these
analysis methods are patented and/or integrated into proprietary commercial software
packages which severely limits accessibility to researchers.

As a corrective alternative, this proposal will provide an open-source software toolkit for
core pulmonary image analysis tasks across multiple modalities, many of which we have proposed
previously in past publications.  These basic tasks include pulmonary image registration,
template building for cross-sectional and longitudinal (i.e., respiratory cycle) analyses,
and functional and structural lung image segmentation.  In addition to the software, we will
provide both the input and output data consistent with open-science principles not only so that other users can it to
reproduce our results, but it will also allow researchers to use it in an unrestricted manner
in their own studies.   Formally, this proposal is defined by the following specific aims:

* __Specific Aim 1:__  __Develop a set of open-source software tools for CT, proton, and He-3
pulmonary computational analysis.__  These open-source software tools will specifically
target pulmonary image analysis and comprise core application functions such as
inspiratory/expiratory registration for inferring pulmonary kinematics, ventilation-based segmentation,
lung and lobe estimation, airway segmentation, and calculation of clinical indices for
characterization of lung development and pathology.
* __Specific Aim 2:__  __Provide multiple sets of multi-modal annotated lung data (CT, proton,
and He3) for unrestricted public use.__  In addition to the public unavailability of the
algorithms used to produce the results discussed in certain publications, the input and output
data is also typically not available.  Such availability would be invaluable to other
researchers in the community for appropriation for their own purposes including algorithmic
performance assessment and running the proposed prior-based methods requiring annotated
input data.
* __Specific Aim 3:__  __Evaluate and disseminate multiple complete studies with input data
from multiple investigators to showcase the utility of the tools and data provided with this
proposal.__  In order to maximize the utility of the proposed pulmonary image analysis
framework, our proposal also includes making available the input data from multiple
researchers (with their permission) involved in a variety of pulmonary research questions and
the output data produced by the framework.  Among other purposes, this contribution will provide
complete, concrete examples demonstrating usage of the proposed contribution.

As principal developers of the popular, open-source ANTs (Advanced Normalization Tools)
package, we have extensive experience in the development of well-written software that has
gained much traction in the neuroscience community.  We have also participated in several
image analysis competitions for a variety of applications (neuro, pulmonary, and cardiac)
and data scaling and believe that this will also contribute to our success in
accomplishing the goals of this application.


\newpage

# Research Strategy

## __3(a) Significance__
Well-vetted and publicly available software is a significant benefit
to targeted research communities.  For example, the neuroscience community has greatly
benefited from highly evolved software packages such as FreeSurfer [@Fischl:2012aa], the FMRIB Software
Library (FSL) [@Jenkinson:2012aa], the Analysis of Functional NeuroImages (AFNI) package [@Cox:2012aa], and the
Statistical Parametric Mapping (SPM) package [@Ashburner:2012aa].  Performing a pubmed query for any one of
these softwares every year for the past decade (cf Figure 1) illustrates the growing use of
such packages and the research studies that are produced as a result.  However, despite the
absolute number of articles produced using such software and the year-by-year usage increase,
no such analogous set of tools exist for pulmonary-specific research.  In fact, in a recent
review of CT- and MRI-derived biomarkers for pulmonary clinical investigation, the authorial
consensus is that ``universally available image analysis software'' is a major hinderance
to more widespread usage of such imaging biomarkers [@Hoffman:2015aa].

```{r pubmedQuery, include=TRUE, echo=FALSE, warning=FALSE, message=FALSE, results="hide", fig.height=3, fig.width=6, fig.cap="Number of articles per year which use common, publicly available neuroimaging analysis packages (i.e., FreeSurfer, AFNI, FSL, and SPM).  Although the benefits seem clear for the neuroscience community, analogous efforts within the pulmonary community have yet to be undertaken." }
years <- 2005:2014

numberOfAbstractsPerYear <- rep( 0, length( years ) )
for( i in 1:length( years ) )
  {
  cat( "Doing year", years[i], "\n" )
  query = "afni OR fsl OR freesurfer OR (statistical AND parametric AND mapping)"
  res <- EUtilsSummary( query, db = "pubmed", retmax = 5000, mindate = as.character( years[i] ), maxdate = as.character( years[i] ) )
  summary( res )
  fetch <- EUtilsGet( res )
  abstracts <- AbstractText( fetch )
  numberOfAbstractsPerYear[i] <- length( abstracts )
  }

plotDataFrame <- data.frame( Year = as.factor( years ), NumberOfAbstracts = numberOfAbstractsPerYear )
ggplot( data = plotDataFrame, aes( x = Year, y = NumberOfAbstracts, fill = NumberOfAbstracts ) ) +
          geom_bar( stat = "identity" ) +
          scale_fill_gradient( low = "#01256e", high = "#6d0e0e" ) +
          ylab( "Number of articles" ) +
          xlab( "Publication year" ) +
          theme( legend.position = "none" )
```

Medical image analysis libraries (e.g., the NIH-sponsored Insight ToolKit) provide extensive algorithmic
capabilities for a range of generic image processing tasks.  However,
tailored software packages for certain application domains (e.g., lung image analysis) are not
available despite the vast number of algorithms that have been proposed in the literature.
Similar deficiency within the neuroscience community has been one of the primary motivations for the
inception and continued development of our Advanced Normalization Tools (ANTs).  ANTs takes advantage of
the mature Insight ToolKit in providing an optimal software framework for building scripts
and programs specifically for neuroimaging.  For example, the following core neuroimage
processing algorithms have been made available through our ANTs toolkit (complete with
examples and developer-tuned parameters)  and have been used extensively by our group and
others:

* brain normalization [@Avants:2011ab;@Avants:2014aa],
* brain template generation [@Avants:2010aa],
* skull-stripping or brain extraction [@Avants:2010ab;@Tustison:2014ab],
* prior-based Bayesian brain tissue segmentation [@Avants:2011ab],
* cortical gray matter thickness estimation [@Das:2009aa;@Tustison:2014ab],
* brain tumor segmentation [@Tustison:2014aa], and
* cortical labeling [@Wang:2012aa;@Wang:2013aa].

In addition to public availability, some of these algorithms have been showcased in
international competitions and have performed extremely well [@Murphy:2011aa;@Menze:2014aa].

Analogously, several algorithmic categories exist for lung image analysis which, as we have
stated previously, do not exist in any comprehensive, publicly available package.  An
extensive survey concentrating on the years 1999–2004 is given in [@Sluimer:2006aa] which covers computer
aided diagnosis of lung disease and lung cancer in CT (i.e., detection and tracking of
pulmonary nodules) and provides an overview of the many relevant segmentation methods for
pulmonary structures. Although many algorithms existed at the time, continued technical
development has only increased the number of available algorithms.  Following is a small
sampling of more recently reported techniques for CT analysis:

* whole lung differentiation from the chest wall (e.g., [@De-Nunzio:2011aa;@Prasad:2008aa;@Wang:2009aa;@Rikxoort:2009aa])
* bronchial structure extraction (e.g.,[@Zheng:2007aa;@Nakamura:2008aa]; the many submissions to the recent Extraction of Airways from CT (ExACT) challenge of the 2nd International Workshop on Pulmonary Image Analysis [@Lo:2009aa]),
* vasculature segmentation (e.g., [@Agam:2005aa;@Korfiatis:2011aa]),
* lobe and/or fissure detection (e.g., [@Qi:2014aa;@Doel:2015aa]), and
* feature extraction and classification (e.g., [@Uppaluri:1999aa;@Rosas:2011aa;@DeBoer:2014aa]).

Since this list is restricted to CT image analysis, inclusion of additional techniques
specific to other modalities will have additional benefit.  For example, ventilation-based
segmentation for analysis of ventilation lung imaging [@Tustison:2011aa] will also have
significant impact in a comprehensive lung image analysis suite.

Important in any methodological discussion is the crucial importance of parameter selection
which requires domain-specific experience.  For example, although ANTs performance in brain
registration has been independently evaluated and found to be of relatively high quality
[Klein2009], tailoring our registration tool in the EMPIRE10 challenge (Evaluation of Methods
for Pulmonary Image REgistration 2010) required significant empirically-based tuning.  In
addition, new innovations in diffeomorphic registration technology has led to a Symmetric
Normalization B-spline variant which has demonstrated preferred normalizations [@Tustison:2013ac],
particularly for pulmonary data [@Tustison:2015aa].  Note that the goals of this proposal would
significantly support the National Library of Medicine’s own open-source directives in that
all software would be developed using the established Insight ToolKit’s coding and testing
standards with the eventual idea that much (if not all) of the actual code would be contributed
for inclusion in future versions of the Insight ToolKit.

It should also be noted that open-source software, in general, has documented benefits
within the targeted communities for which it is developed and supported.  In addition to
the increase in research output illustrated earlier, open-source permits students and
researchers to learn specific computational techniques in a social environment [@Yunwen:2003aa].
This, in turn, provides motivation for user-based support including potential contributions
such as bug fixes and feature additions.  Additional analyses have shown the tremendous
cost savings that open-source software yields [@Rothwell:2008aa].

## __3(b) Innovation__
Given the lack of open-source solutions for pulmonary image analysis,
the proposal goals would produce an innovative framework for corresponding research.
Many algorithms have been proposed in various technical venues but that which we propose
would provide well-vetted and easy-to-use implementations of specific robust methodologies,
many of which have been developed by our group.

An additional innovative component we are proposing is the inclusion of data and detailed instructions
for generating reproducible, multimodality pulmonary studies using the proposed package with
input data from several of our external collaborators and colleagues.  Specifically, we have
asked several scientists and researchers who are familiar with our work to provide imaging data
of various modalities which we will then process using the proposed toolkit.  These processed
data will then not only be returned to the corresponding providers with detailed instructions
on how to obtain these results in their own labs but will also be provided to the public for any
interested researcher to reproduce the results.  Given the different image acquisition sources,
this strategy should also demonstrate the robustness of our tools.

Included in these analyses will be studies dealing with our own data.  Clinical findings will be
published in traditional venues (e.g., Chest) for the interested researcher.  In addition, we will
provide all image
data and the quantitative analysis scripts as a companion release to accompany the paper
(e.g., see previous similar offerings from our group [@Tustison:2013ac;@Tustison:2014ab]).
 Such a comprehensive clinical
investigation using these tools will not only provide insight into the specifics of certain
pulmonary pathologies
but will also provide a tangible mechanism for using the tools created with this proposal.

## __3(c) Approach__

__Specific Aim 1.__  To develop a set of open-source software tools for CT, proton, and He-3
pulmonary computational analysis.  Development will include several basic tools:

_B-spline-based Symmetric Normalization._  A thorough comparative evaluation with the
well-known ANTs SyN algorithm was performed with a B-spline variant.  The evaluation
utilized multiple publicly available, annotated brain data sets and demonstrated
statistically significant improvement in label overlap measures [@Tustison:2013ac].   We also used the
EMPIRE10 challenge framework to provide an additional comparison in the context of
pulmonary CT image registration [@Tustison:2012aa].  Due to the performance of this new variant,
it has become the preferred transformation model for small deformation image registration
problems (e.g., lung and cardiac [@Tustison:2015ab] applications).

_Multi-feature CT and multi-modal MRI template generation._  we generate subject-specific
templates directly from the image data.  Given the variability in lung shape across
populations and the lack of publicly available lung atlases, generating population- or
subject-specific templates enhances the accuracy of the longitudinal analysis described
in this work.  Applicable to pulmonary data is the template construction algorithm described
in [@Avants:2010aa] which was applied to T1-weighted brain data.   However, the simultaneous acquisition
of the 3He and 1H images lends itself to multimodal processing [@Tustison:2014aa] in which both modalities
are used to simultaneously produce 3He and 1H templates.  This process is represented in
Fig. 1 for a single subject.

_Atlas-based lung segmentation._  Identification of anatomical structure in MRI is often a
crucial preprocessing step for quantification of morphological features or functional
information.  Quantitative regional analysis often requires the identification of lung
and lobar anatomy.  Although much algorithmic research for lung segmentation has been
reported in the CT literature [@Rikxoort:2013aa],  co-opting such technologies is complicated by MRI-specific
issues such as RF coil inhomogeneity, presence and resolution of structural detail, and
the absence of a physically-based intensity scaling.

We recently proposed a multi-atlas approach for automatically segmenting the left and right
lungs in proton MRI [@Tustison:2015aa].  Multi-atlas approaches to segmentation have proven highly
successful in neuroimaging [@Wang:2012aa;Wang:2013aa] which translates readily to a pulmonary context.  Many
current strategies for lung image segmentation employ low-level processing techniques based
on encodable heuristics.  Consensus-based strategies, in contrast, optimize the prior
knowledge applied to a specific segmentation problem (cf Figure 2).

![Sample lung and lobe estimation results in both proton MRI and CT using our
atlas-based strategy.  (Left) Lung segmentation and lobe estimation results for the given
proton MRI.  Although lobe estimation is dependent solely on the warped atlases, we are
able to obtain accurate estimates of lobes which are useful for more regional analysis
and provide a more intuitive and universal subdivision of the lungs than previous partitioning
schemes.  (Right) The utility of this method extends to CT where the integrity of lobar anatomical
markers (such as the lack fissures illustrated by the red arrows) have been compromised due to
disease.](Figs/lungEstimation.png)

_Atlas-based lobe estimation._  For regional investigation of certain lung pathologies and
conditions, it is often useful to quantify measurements of interest within more localized
regions, such as the lobes.  However, as mentioned previously, there is little (if any)
usable information in proton MRI for image-based lobar segmentation which has led to
alternative geometric subdivisions which are ad hoc, non-anatomical, and do not adequately
address intra- and inter-subject correspondences.  However, we can take advantage of
inter-subject similarities in lobar geometry to provide a prior-based estimation of
lobar divisions using a consensus labeling approach (cf Figure 2).

To generate the lobe segmentation in a target proton lung image, we first generate the
binary lung mask for the proton lung image as described in the previous subsection.  We
then register the set of CT lung masks to the target binary lung mask using the same
registration approach mentioned earlier [@Tustison:2013ac].
 Subsequently, we warp the set of CT lobe labels to the target image using
the CT mask-to-proton mask transformation.  Since we have no intensity information inside
the target lung mask and CT atlas lung masks, we use a simply majority voting strategy to
generate the optimal labeling for the target image.  Following the majority voting, we
remove any labelings outside the lung mask and assign any unlabeled voxels with the label
closest in distance to that voxel.

_Ventilation-based image segmentation._  Developments in MRI research utilizing noble gases,
such as 3He and 129Xe, have demonstrated the capability of visualizing alveolar and bronchial
air spaces. Currently, hyperpolarized 3He MRI is a low-risk investigatory technique that
provides high spatial and temporal resolution images of the air spaces of the lungs and has
been used to investigate a variety of lung diseases. Automated or semiautomated approaches
for classifying areas of varying degrees of ventilation are of potential benefit for
facilitating such investigation.

In [@Tustison:2011aa], we presented an automated algorithmic pipeline for ventilation-based
partitioning of the lungs in hyperpolarized 3He and 129Xe MRI.  Since then, we have
continued to improve this segmentation pipeline including the recent introduction of
an ANTs-based implementation of the patch-based denoising protocol described in
[@Manjon:2010aa].  An example of a set of longitudinal segmentation results are provided
in Figure 3.

![Pulmonary functional segmentation using the algorithmic framework first described in [@Tustison:2011aa]
for hyperpolarized 3He MRI.  These data were taken from a current study looking at the
implications in ventilation pre- and post-albuterol intake including an additional
acquisition at some delay period following the post-albuterol imaging.  The
ventilation-based segmentation is as follows:  red = no ventilation, green = poor
ventilation, blue = normal ventilation, and yellow = normal to hyper-ventilation.
Note the improvement in both the qualitative assessment of the ventilation map (top) and the corresponding
segmentation time course (bottom) followed by an approximate return to pre-albuterol
conditions following the delay period.](Figs/prePostAlbuterol.png)

![Voxelwise regression analysis to determine image-based response to treatment.  First,
a multi-modal, single-subject template is created to bring all time point images to
the same coordinate system.  4-D segmentation is performed on the longitudinal time series
of 3-D image volumes.  Treatment
effects are expected to follow the simplified treatment hypothesis illustrated with the
dashed blue line in the plot on the right.  To explore how the longitudinal change in expected
ventilation follows this treatment hypothesis with image data, we smooth the aligned expected
ventilation maps (to account for potential voxelwise misalignments) and then quantify how the
voxelwise intensities regress with the simplified treatment hypothesis. ](Figs/longitudinalStudy.png)


_Quantitative CT indices._  Imaging biomarkers for characterizing emphysema in CT have
have been well researched, although there are ample opportunities to refine these methods
as well as to introduce more advanced approaches. Examples of the latter include texture
analysis for identifying the centrilobular and groundglass opacities and fractal and
connectivity approaches to differentiate centrilobular from panlobular emphysema. The
indices for CT image analysis can roughly be divided into those that characterize the
pulmonary parenchyma and those that characterize the airways. The former are important
for subjects with an emphysematous component of disease, whereas the latter are important
for subjects with a bronchitic component of disease. Such indices can also be studied not
only at any particular single time point, but also for changes with time. The addition of
quantitative morphologic measurements of the airways provides an assessment of the
contribution of airway changes to chronic lung disease.

Table 1 provides an historical overview of the type of
discriminative measurements that have been used for CT lung assessment. _An important
premise of this proposal is that many of these measurements can also be directly applied
to discriminative analysis using 3HeMRI for a variety of lung diseases._  We have already
implemented many of these image features and have contributed the result of our work to
the Insight Toolkit (ITK) of the National Institutes of Health (e.g., [@Tustison:2008aa;@Tustison:2009aa]). As an
open-source repository for medical image analysis algorithms, contribution of our work
to the ITK allows researchers full access to the latest image analysis algorithms in
addition to avoiding research redundancy. It is also beneficial in that the entire ITK
community participates in the vetting of the software library.

[7;9;16;18;19;24;25;26;30;31;32;33;37;41;46;54;55;56;57;59;61;63;64;65;66;68;70;74;76;77;82;83;84;85;92;98;110;111;112;114;117;118;120;121]

_Airway and vessel segmentation._  We should propose to implement something here.  We should look at the Slicer/VMTK airway segmentation model.



__Specific Aim 2.__  To provide multiple sets of multi-modal annotated lung data (CT, proton, and He3) for public use.

\input{ct_table.tex}
\clearpage

\newpage

# References

